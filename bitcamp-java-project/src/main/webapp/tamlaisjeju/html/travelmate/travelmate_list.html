<!DOCTYPE html>
<html lang="ko">

<head>
	<!-- meta tags -->
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>탐라는제주 - 숨어 있던 진짜 hot한 제주</title>
	<link rel="shortcut icon" type="image/x-icon" href="/img/favicon.ico">
	<meta property="og:title" content="탐라는제주">
	<meta property="og:type" content="website">
	<meta property="og:description" content="탐라는제주 - 숨어 있던 진짜 hot한 제주">
	<!-- font -->
	<link rel="stylesheet" href="//cdn.rawgit.com/hiun/NanumSquare/master/nanumsquare.css">

	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt"
	    crossorigin="anonymous">
	<!-- css -->
	<link rel="stylesheet" href="../../node_modules/bootstrap/dist/css/bootstrap.min.css">
	<link rel="stylesheet" href="../../css/common.css" />
	<link rel="stylesheet" href="../../css/layout.css" />
	<link rel="stylesheet" href="../../css/sub04.css" />
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
		<!-- sweetArert2 -->
	<link rel="stylesheet" href="../../node_modules/sweetalert2/dist/sweetalert2.min.css">
	<link rel="stylesheet" href="../../node_modules/animate.css/animate.min.css">

</head>

<body>


	<header id="header"></header>


	<div id="container" class="container">
		<div id="visual">
			<img src="../../img/sub04/sub04_visual.jpg" alt="제주의 풍경">
		</div>
		<div id="content" class="content wrapper">


			<h3>동행을 찾는 여행자를 위한 커뮤니티</h3>

			<p class="h3_txt">혼자 하는 여행을 즐기시나요? 아니면 누군가와 함께하는 여행을 원하시나요?</p>

	
			<div class="board_list travelmate">
				<div id="contentList" class="box_wrap clear">

				</div>
				<!-- box_wrap end -->


				<div class="btn_wrap" style="text-align: end;">
					<!-- Trigger/Open The Modal -->
					<button id="accom_regi" style="border: 1px solid #2793db; color: #2793db; background-color: white;" type="button" class="btn btn-primary"
					    data-toggle="modal" data-target="#exampleModalCenter1">동행모집</button>
					<!-- 
					   <a href="../planner/planner_form.html" style="border: 1px solid #2793db; color: #2793db; background-color: white;">동행모집</a>
					    -->
				</div>
				<!-- Modal -->
				<form name="form1" id="travelmate_form">
					<div class="modal fade" id="exampleModalCenter1" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
						<div class="modal-dialog modal-dialog-centered" role="document">
							<div class="modal-content">
								<div class="modal-header" id="m-header">
									<h5 class="modal-title" id="exampleModalCenterTitle" style="padding-bottom: 0px;">동행하기</h5>
									<button type="button" class="close" data-dismiss="modal" aria-label="Close">
										<span aria-hidden="true">&times;</span>
									</button>
								</div>
								<div id="mo_body" class="modal-body">
									<div id="sl_list" style="padding-top: 10px;">
										<label for="mTitle">여행제목</label>
										<select id="mTitle" style="height: 50px; width: 100%; border: 1px solid #e9e9e9;">

										</select>
									</div>
								</div>
								<div class="modal-footer">
									<button type="button" class="btn btn-secondary" data-dismiss="modal">취소</button>
									<a id="regi" href="travelmate_insert.html" class="btn btn-primary">등록하기</a>
								</div>
							</div>
						</div>
					</div>
				</form>
				<!-- MODAL -->

				<div class="pagination_wrap">
					<div id='pageBtn' class="pagination">

					</div>
					<!-- pagination end -->
				</div>
				<!-- pagination_wrap end-->

			</div>
			<!-- board_list end-->
		</div>
		<!-- content end-->

	</div>
	<!-- container end-->

	<footer id="footer"></footer>
	<!-- js -->
	<script src="../../node_modules/handlebars/dist/handlebars.min.js"></script>
	<script src="../../node_modules/jquery/dist/jquery.min.js"></script>
	<script src="../../node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
	<script src="../../js/common/common.js"></script>
	<script type="text/javascript">
		$(document).ready(function () {
			$("#header").load("../include/sub_header.html")
			$("#footer").load("../include/sub_footer.html")
			/* id 지정을 통해서도 가능합니다. 
			 $("#header").load("header.html #navbar")
			 */
		});
	</script>
	<!-- sweetArert2 -->
	<script type="text/javascript" src="../../node_modules/sweetalert2/dist/sweetalert2.min.js"></script>

	<!-- 모달 취소버튼시 초기화 되는 스크립트 -->
	<!-- <script type="text/javascript">
		$('#exampleModalCenter').on('shown.bs.modal', function () {
			$('#mTitle').val("");
			$('#pDesc').val("");
			$('#sDate').val("");
			$('#eDate').val("");
			$('#mTem').val("");
			$('#mWithNum').val("");
		});
	</script> -->
	<!-- input type-date에 플레이스홀더를 가능하게 하는 스크립트. -->
	<script>
		$(
				'input[type="date"], input[type="datetime"], input[type="datetime-local"], input[type="month"], input[type="time"], input[type="week"]'
			)
			.each(function () {
				var el = this,
					type = $(el).attr('type');
				if ($(el).val() == '')
					$(el).attr('type', 'text');
				$(el).focus(function () {
					$(el).attr('type', type);
					el.click();
				});
				$(el).blur(function () {
					if ($(el).val() == '')
						$(el).attr('type', 'text');
				});
			});
	</script>
	<!-- <script type="text/javascript">
		$('#regi')
			.click(
				function () {

					var param = {
						mTitle: $('#mTitle').val(),
						pDesc: $('#pDesc').val(),
						sDate: $('#sDate').val(),
						eDate: $('#eDate').val(),
						mTem: $("#mTem option:selected").text(),
						mWithNum: $('#mWithNum option:selected')
							.text(),
						gen: $('#recr-gen option:selected').text() == "남자" ? 1 : $('#recr-gen option:selected').text() == "여자" ? 2 : 0
					};

					$.ajax({
						type: "POST",
						url: serverRoot + "/json/accompanyregi/add",
						data: param,
						success: function (data) {
							location.href = "planner_regi.html";
						},
						error: function (data) {
							alert("빈 칸을 채워주세요.");
						}

					});
				});
	</script> -->

	<script>
		var link = document.location.href.split("?")[1];

		$(document).ready(function () {
			$("#mTitle").change(function () {
				$("#regi").attr("href", "travelmate_insert.html?" + $("#mTitle option:selected").val().split(":")[1].split(
					"/")[0]);
			});
		});

		$('#accom_regi').click(function () {

			var moBody = $('#mo_body');
			var mTit = $('<div id="sl_list" style="padding-top: 10px;">');
			var slList = $('<select id="mTitle" style="height: 50px; width: 35%; border: 1px solid #e9e9e9;">' +
				'<option value="no">');


			$.ajax({
				url: serverRoot + "/json/planner/list",
				dataType: "json", // 데이터타입을 json 으로 받아옴
				success: function (main) {
					console.log(main)
					if (main != null) {

						$.ajax({
							url: serverRoot + "/json/content/list",
							dataType: "json", // 데이터타입을 json 으로 받아옴
							success: function (main2) {
								console.log("111111111111");
								console.log(main2);
								var memberId;
								var contentMember;

								$.get(serverRoot + "/json/auth/islogin", {}, user => {
									memberId = decodeURIComponent(user.id);
									console.log(memberId);

									for (j = 0; j < main2.length; j++) {
										console.log(main2[j].id);
										console.log(memberId);
										if (memberId == main2[j].id) {

											/*$(slList).text(main[i].title);
											$(mTit).append(slList);
											$(moBody).append(mTit);*/
											$('#mTitle').append("<option>" + "번호:" + main2[j].no + "/제목:" + main2[j].title + "</option>");

										}
									}
								})
							}
						});
					} else {
						alert("플랜을 만들어주세요!!");
						location.href = "planner_form.html";
					}
				},
				error: function (er) {
					alert("값을 불러올 수 없습니다. 다시 확인해 주세요");
				}
			});
		});
	</script>

	<script>
		var link = document.location.href.split("?")[1];
		$(document).ready(function () {
			$.ajax({

				type: "GET",

				url: serverRoot + "/json/partner/list",

				dataType: "JSON", // 옵션이므로 JSON으로 받을게 아니면 안써도 됨

				success: function (data) {
					var pageNo = data.length / 6;
					Math.ceil(pageNo)
					$('#pageBtn').append(
						"<a id='preBtn' href='#'>&laquo;</a>"
					)
					for (let i = 0; i < Math.ceil(pageNo); i++) {
						console.log(Math.ceil(pageNo))
						$('#pageBtn').append(
							"<a href='#' id='page_" + (i + 1) + "' class='pageNoBtns' onclick='pageClick(this)'>" + (i +
								1) + "</a>"
						)
					}
					$('#pageBtn').append(
						"<a id='nextBtn' href='#'>&raquo;</a>"
					)
					$('#page_1').trigger('click')



					$('#preBtn').click(function () {
						if ($('.active').prev()[0] != $('#preBtn')[0]) {
							$('.active').prev().trigger('click')
						}
					})

					$('#nextBtn').click(function () {
						if ($('.active').next()[0] != $('#nextBtn')[0]) {
							$('.active').next().trigger('click')
						}
					})

				}
			})

		})

		var img_check = [];

		function pageClick(val) {
			var no = val.innerText;

			$('.pageNoBtns').removeClass('active')
			$(val).addClass('active')
			$.ajax({
 
				type: "GET",

				url: serverRoot + "/json/partner/listpageNo=" + no,

				dataType: "JSON", // 옵션이므로 JSON으로 받을게 아니면 안써도 됨

				success: function (pldata) {
					console.log(pldata);
					$.ajax({

						type: "GET",

						url: "http://api.visitkorea.or.kr/openapi/service/rest/KorService/areaBasedList?serviceKey=vZFIZ2wi8C6wIsg4YtILwtO%2BAm2Dfnrg%2F9gqJyC8%2BEAig4C8B2uVd%2B4eky0ER9d5Rhdlrqw2zxfy2RO32v6Q8A%3D%3D&pageNo=1&startPage=1&numOfRows=999&pageSize=20&MobileApp=AppTest&MobileOS=ETC&arrange=A&areaCode=39&listYN=Y&_type=json",

						dataType: "JSON", // 옵션이므로 JSON으로 받을게 아니면 안써도 됨

						success: function (api) {
							img_check = api.response.body.items.item;
							console.log(img_check)
							$('#contentList').empty();

							for (let partner of pldata) {
								$.ajax({

									type: "GET",

									url: serverRoot + "/json/planner/" + partner.plno,

									dataType: "JSON", // 옵션이므로 JSON으로 받을게 아니면 안써도 됨

									success: function (plan) {
										console.log(plan)

										$.ajax({

											type: "GET",

											url: serverRoot + "/json/travelPlan/" + partner.plno,

											dataType: "JSON", // 옵션이므로 JSON으로 받을게 아니면 안써도 됨

											success: function (pt) {
												console.log(pt[0].tno);
												for (k = 0; k < img_check.length; k++) {
													if (pt[0].tno == img_check[k].contentid) {
														var genders;
														if (partner.gender == 0) {
															genders = '남자';
														} else if (partner.gender == 1) {
															genders = '여자';
														} else if (partner.gender == 2) {
															genders = '무관';
														}
														console.log(partner.length)
														console.log(plan.length)

														$('#contentList').append(
															"<figure class='effect type01'>" +
															"<span class='r_status open'>모집중</span>" +
															"<img src=" + img_check[k].firstimage2 + ">" +
															"<figcaption>" +
															"<b>" +
															"<span class='title'>" + partner.title + "</span> " +
															"<span class='date'>" + plan.startDate + " ~ " + plan.endDate + "</span> " +
															"<span class='gender'>" + genders + "</span> " +
															"<span class='capacity'	>"+  partner.capa +"명"+ "</span> " +
															"</b>" +
															"<a href='travelmate_view.html?" + plan.no + "'>View more</a>" +
															"</figcaption>" +
															"</figure>");
													}
												}
											}
										});
									}
								});
							}
						}
					});
				}
			});
		}
	</script>

	<style type="text/css">
		#travelmate_form {}

		#travelmate_form h5 {
			margin: 0;
			padding: 0;
			font-weight: normal;
			text-align: center;
			color: #fff;
		}

		#travelmate_form h5::before {
			display: none;
		}

		#travelmate_form .modal-header {
			background-color: #104ba0;
		}

		#travelmate_form .modal-header .close {
			color:#fff;
			font-size:45px;
		}

		#travelmate_form #mTitle {
			width: 100%;
			margin-bottom: 10px;
			padding: 5px;
			border: 1px solid #e9e9e9;
			line-height: 50px;
		}

		#travelmate_form #pDesc {
			width: 100%;
			height: 120px;
			padding: 8px;
			border: 1px solid #e9e9e9;
			box-sizing: border-box;
			resize: none;
		}

		#travelmate_form #sDate {
			width: 48.1%;
			text-align: left;
			border: 1px solid #e9e9e9;
			height: 50px;
			padding-left: 10px;
		}

		#travelmate_form #eDate {
			width: 48.1%;
			text-align: left;
			border: 1px solid #e9e9e9;
			height: 50px;
			padding-left: 10px;
		}

		#travelmate_form #mWithNum {
			padding: 5px;
		}
		
	</style>

</body>

</html>