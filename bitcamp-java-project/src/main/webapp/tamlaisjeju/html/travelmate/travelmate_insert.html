<!DOCTYPE html>
<html lang="ko">

<head>
	<!-- meta tags -->
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>탐라는제주 - 숨어 있던 진짜 hot한 제주</title>
	<link rel="shortcut icon" type="image/x-icon" href="../../img/common/favicon.ico">
	<meta property="og:title" content="탐라는제주">
	<meta property="og:type" content="website">
	<meta property="og:description" content="탐라는제주 - 숨어 있던 진짜 hot한 제주">
	<!-- font -->
	<link rel="stylesheet" href="//cdn.rawgit.com/hiun/NanumSquare/master/nanumsquare.css">
	<!-- Bootstrap CSS -->
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css">
	<!-- 	integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" -->
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt"
	    crossorigin="anonymous">
	<!-- css -->
	<link rel="stylesheet" href="../../css/common.css" />
	<link rel="stylesheet" href="../../css/layout.css" />
	<link rel="stylesheet" href="../../css/main.css" />
	<link rel="stylesheet" href="../../css/sub09.css" />
	<link rel="../../node_modules/lightbox2/dist/css/lightbox.css" />
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	<!-- sweetArert2 -->
	<link rel="stylesheet" href="../../node_modules/sweetalert2/dist/sweetalert2.min.css">
	<link rel="stylesheet" href="../../node_modules/animate.css/animate.min.css">
</head>

<body>
	<header id="header"></header>

	<div id="sub09" class="container">
		<div id="visual">
			<img src="../../img/sub01/sub01_visual.jpg" alt="대표이미지">
		</div>
		<div id="content" class="content wrapper">
			<nav class="aside_wrap">
				<div class="info-left-box">
					<!-- <div class="user-info-box">-->
						<!-- <div class="author-box">
							<div class="author-img">
								<a target="_blank" href="#"> <img
									src="../../img/sub09/meme.PNG">
								</a>
							</div>
							<div class="author-name">
								<h3>왕로</h3>
							</div>
						</div>-->
						<!--author0box -->


						<!-- <div class="author-page-links">-->
							<!-- <ul>
								<li><a style="padding-left: 5px;"> <span>여행일정</span> <span
										id="tra_schedule" class="count">(40)</span>
								</a></li>
								<li><a> <span>여행리뷰</span> <span id="tra_review"
										class="count">(40)</span>
								</a></li>
								<br>
								<li><a> <span>동행횟수</span> <span id="acp_num"
										class="count">(40)</span>
								</a></li>
								<li><a> <span>회원댓글</span> <span id="mem_comment"
										class="count">(40)</span>
								</a></li>
							</ul>-->
						<!-- </div>-->
					<!-- </div> -->

					<!--user-left-box-->
				</div>
				<!--info-left-box-->

				<!--info-right-box 시작-->
				<div class="info-right-box">
					<!-- <nav class="nav-warp">
						<ul>
							<li>
								<a class="btn-top nav-btn-top story-view-nav-btn" id="top">Top</a>
							</li>

							<li class="story-view-nav-li">
								<a class="nav-cmt story-view-nav-btn" data-id="comment" id="h-bottom">
									<span class="plan-comment-count">bottom</span>
								</a>
							</li>
						</ul>
					</nav> -->
				</div>
				<!--info-right-box 종료-->
			</nav>
			<!-- aside_wrap -->

			<!-- cont_wrap 시작 -->
			<div class="cont_wrap">


				<div class="plan-info-top">
					<div class="plan-detail-txt">
						<h2 class="plan-tit">동행 정보</h2>
						<div class="plan-txt">
							<pre id="aWord"></pre>
						</div>

						<div class="more-info-con">
							<div class="mainTitle">
								<input type="text" placeholder="제목을 입력해주세요" style="width: 100%">
							</div>
							<div class="gender">
								<select>
									<option value="0">남자</option>
									<option value="1">여자</option>
									<option value="2">무관</option>
								</select>
							</div>
							<div class="p-num">
								<select>
									<option value="0">0</option>
									<option value="1">1</option>
									<option value="2">2</option>
									<option value="3">3</option>
									<option value="4">4</option>
									<option value="5">5</option>
									<option value="6">6</option>
									<option value="7">7</option>
									<option value="8">8</option>
									<option value="9">9</option>
									<option value="10이상">10이상</option>
								</select>
							</div>
							<!-- <div class="theme-round">
								<p>
									<span> 여행시작일 : </span>
									<span id=sdt></span>
								</p>
								<p>
									<span> 여행종료일 : </span>
									<span id=edt></span>
								</p>
								<p>
									<span id="wNum"></span>
									<span>명</span>
								</p>
								<p id="theme"></p>
							</div> -->

							<div class="theme-round">
								<!-- <p>
									<span id="b-hits">조회수 :</span>
								</p>
								<p>
									<span id="b-reco">추천수 :</span>
								</p>  -->
							</div>
						</div>
					</div>



					<!-- schedule_summary end-->



				</div>
				<!-- cont_wrap 종료 -->
				<!--지도 시작-->
				<div id="map">
					<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=a39a869b2b427425c966081cb35dc719"></script>


				</div>
				<!--지도 종료-->
				<!--cont_wrap의 day시작-->
				<div class="story-day">
					<div class="spot-container">
						<div class="story-conts">

							<div class="spot-note-box">
								<div class="spot-contents">
								</div>
								<h3>
									<strong id="st_day"></strong>
									<span class="desc"></span>
								</h3>

							</div>
							<!--spot-note-box-->

						</div>
					</div>
				</div>
				<button type="button" id="bt_update" class="btn" style="left: 90%;">저장하기</button>
				<!-- 
				<div class="author-info">
					<div class="conts-label">
						<div class="like-count">
							<a class="">좋아요 <span>170</span>
							</a>
						</div>
						<div class="comment-count">
							<a class="show-comments-of-note" id="comment-space">댓글 <span>100</span>
							</a> 스크립트로 이동을 위한 아이디
						</div>
					</div>
				</div>
 				-->
				
				<!-- cont_wrap 끝남 -->
			</div>
			<!-- content end -->
		</div>
	</div>
	<!-- container end -->
	<div id="footer"></div>
	<!-- js -->
	<script src="../../node_modules/handlebars/dist/handlebars.min.js"></script>
	<script src="../../node_modules/jquery/dist/jquery.min.js"></script>
	<script src="../../node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
	<script src="../../node_modules/lightbox2/dist/js/lightbox.js"></script>
	<script src="../../js/common/common.js"></script>
	<!-- sweetArert2 -->
	<script type="text/javascript" src="../../node_modules/sweetalert2/dist/sweetalert2.min.js"></script>

	<!--footer -->
	<script type="text/javascript">
		$(document).ready(function () {
			$("#header").load("../include/sub_header.html")
			$("#footer").load("../include/sub_footer.html")
			/* id 지정을 통해서도 가능합니다. 
			 $("#header").load("header.html #navbar")
			 */
		});
	</script>
	<!--왼쪽 fixed-->
	<script>
		$(document).ready(function () {
			$(window).bind('scroll', function () {
				var container = $('.container').height();
				var content = $('.content').height();
				if ($(window).scrollTop() > container - content - 30) {
					if ($(window).scrollTop() > content - 600) {
						$('nav').removeClass('fixed');
						$('nav').addClass('absolute');
						return;
					}
					$('nav').removeClass('action');
					$('nav').removeClass('absolute');
					$('nav').addClass('fixed');
				} else {
					$('nav').removeClass('absolute');
					$('nav').removeClass('fixed');
					$('nav').addClass('action');
				}
			});
		});
	</script>
	<!--top scroll로 이동-->
	<script type="text/javascript">
		$('#top').click(function () {
			$('body,html').animate({
				scrollTop: 0
			}, 1500);
		});
	</script>
	<!--bottom scroll로 이동-->
	<script type="text/javascript">
		$("#h-bottom").click(function () {
			$('html, body').scrollTop($(document).height());
		});
	</script>

	<!--원하는 위치 scroll로 이동-->
	<script type="text/javascript">
		$("#day-1").click(function () {
			var scrollPosition = $($(this).attr("d1")).offset().top;
			$("body").animate({
				scrollTop: scrollPosition
			}, 500);
		});
	</script>

	<script>
		var link = document.location.href.split("?")[1];
		$("#bt_update").click(function () {
			$(document).ready(function () {
				var aWord = $('#aWord');
				var sDay = $('#sdt');
				var eDay = $('#edt');
				var partner = $('#wNum');
				var theme = $('#theme');
				var hits = $('#b-hits');
				var recoNum = $('#b-reco');
				var mTitle = $('#mainTitle');

				var params = {
					gender: $('.gender option:selected').val(),
					capa: $('.p-num option:selected').val(),
					title: $('.mainTitle input')[0].value,
					plno: link
				};

				$.ajax({
					url: serverRoot + "/json/planner/" + link,
					dataType: "json", // 데이터타입을 json 으로 받아옴
					success: function (main) {

						$.ajax({
							type: "POST",
							url: serverRoot + "/json/partner/add",
							data: params,
							success: function (main) {
								TPupdat();
							}
						});
						$(sDay).append(main.startDate);
						$(eDay).append(main.endDate);
						$(partner).append(main.num);
						$(theme).append(main.theme);
					},
					error: function (er) {
						swal({
							type: 'error',
							title: '오류',
							text: '값을 불러올 수 없습니다. 다시 확인해 주세요',
							showConfirmButton: false,
							timer: 1500
						})
						// alert("값을 불러올 수 없습니다. 다시 확인해 주세요");
					}
				});
			});
		});
	</script>



	<script>
		var link = document.location.href.split("?")[1];
		var maxDay = -1;
		var contentId = [];
		var planday = -1;;

		$(document).ready(function () {


			$.ajax({
				url: serverRoot + "/json/travelPlan/" + link,
				dataType: "json", // 데이터타입을 json 으로 받아옴
				success: function (data) {
					console.log(data);
					let modalIndex = 0;

					/* $.ajax({
					url : serverRoot + "/json/planner/selectOne",
					dataType : "json", // 데이터타입을 json 으로 받아옴
					success : function(titleDay) { */
					planday = data[0].plno;


					$.ajax({
						url: "http://api.visitkorea.or.kr/openapi/service/rest/KorService/areaBasedList?serviceKey=vZFIZ2wi8C6wIsg4YtILwtO%2BAm2Dfnrg%2F9gqJyC8%2BEAig4C8B2uVd%2B4eky0ER9d5Rhdlrqw2zxfy2RO32v6Q8A%3D%3D&pageNo=1&startPage=1&numOfRows=999&pageSize=20&MobileApp=AppTest&MobileOS=ETC&arrange=A&areaCode=39&listYN=Y&_type=json",
						dataType: "json", // 데이터타입을 json 으로 받아옴
						success: function (data2) {
							//console.log(data);
							//console.log("---------------");
							console.log(data2);

							var mapContainer = document.getElementById('map'), // 지도를 표시할 div 
								mapOption = {
									center: new daum.maps.LatLng(33.379235341729505, 126.56948671100452), // 지도의 중심좌표
									level: 10 // 지도의 확대 레벨
								};

							var map = new daum.maps.Map(mapContainer, mapOption); // 지도를 생성합니다

							var infowindow = new daum.maps.InfoWindow({
								zIndex: 1
							});
							var nowPlanDay = data[0].plday;

							var day = $('#st_day');
							var day_num = $('<a id="d1">');

							$(day_num).text("day " + currentPage);
							$(day).append(day_num);



							for (let i = 0; i < data.length; i++) {
								//console.log(data2.response.body.items.item);
								//console.log(data2.response.body.items.item.length);
								for (let j = 0; j < data2.response.body.items.item.length; j++) {
									//console.log(data2.response.body.items.item[j].contentid);
									//for(let item of data2.response.body.items.item) {}   
									if (data[i].tno == data2.response.body.items.item[j].contentid) {
										//$(data2[j].tno).append(data[i].contentid);
										//console.log(data);
										console.log(data2.response.body.items.item[j])

										contentId.push(data[i].tno);

										if (data[i].plday > nowPlanDay) {

											var dayIden = $('.spot-note-box');

											nowPlanDay = data[i].plday;

											let newNode = $("<p>");
											$(newNode).text("day " + nowPlanDay);

											$(dayIden).append(newNode);
											console.log(nowPlanDay);
										}


										var dayCon = $('.spot-note-box');
										var spot_tit = $('<div class="spot-tit type">');
										var spot_title_area = $('<a class="spot-title-area">');
										var h4_title = $('<h4 class="i-h4">');
										var span_title = $('<span class="m-title">');

										//타이틀부분
										$(span_title).text(data2.response.body.items.item[j].title);
										$(h4_title).append(span_title);
										$(spot_title_area).append(h4_title);
										$(spot_tit).append(spot_title_area);
										$(dayCon).append(spot_tit);

										var spot_cont = $('<div class="spot-contents">');

										var cont_txt_area = $('<div class="conts-txt-area">');
										var img_modal = $(
											'<div id="img-modal" class="medium-insert-image ui-sortable" contenteditable="false">');

										var img = $('<img data-toggle="modal" data-target="#exampleModal' + modalIndex + '">');

										var modal_fade = $(
											'<div class="modal fade" id="exampleModal' + (modalIndex++) +
											'" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">'
										);
										var modal_dialog = $('<div class="modal-dialog" role="document">');
										var modal_content = $('<div class="modal-content">');
										var modal_header = $('<div class="modal-header">');
										var button_close = $('<button type="button" class="close" data-dismiss="modal" aria-label="Close">');
										var span_aria = $('<span aria-hidden="true">');

										var m_img = $('<img class="m-img">');

										var r_cm = $('<textarea class="r-cm">');


										//console.log(data2.response.body.items.item[j].firstimage);
										/*원래 이미지 부분*/

										console.log(data2.response.body.items.item[j]);

										$(img).attr("src", (data2.response.body.items.item[j].firstimage == undefined ?
											"../../img/common/noimage.jpg" : data2.response.body.items.item[j].firstimage));
										$(img_modal).append(img);
										$(dayCon).append(img_modal);
										/*이미지 설명부분*/
										$(img_modal).append(r_cm);
										$(cont_txt_area).append(img_modal);
										$(dayCon).append(cont_txt_area);
										/*원래 이미지 종료*/
										//$(spot_cont).text(cont_txt_area);
										$(dayCon).append(spot_cont);
										/*모달 이미지 부분*/
										$(m_img).attr("src", (data2.response.body.items.item[j].firstimage == undefined ?
											"../../img/common/noimage.jpg" : data2.response.body.items.item[j].firstimage));

										/*모달의 x버튼 시작*/
										$(span_aria).text("x");
										$(button_close).append(span_aria);
										$(modal_header).append(button_close);
										//$(modal_content).append(modal_header);
										/*모달x버튼 종료*/
										$(modal_content).append(modal_header);
										$(modal_content).append(m_img);
										//$(modal_dialog).append(modal_header);
										$(modal_dialog).append(modal_content);
										$(modal_fade).append(modal_dialog);
										$(img_modal).append(modal_fade);
										$(cont_txt_area).append(img_modal);
										$(spot_cont).append(cont_txt_area);
										$(dayCon).append(spot_cont);
										/*모달 이미지 부분 종료*/
										/* if(data[i].plday > maxDay)
                        	  maxDay = data[i].plday; */

										// 마커가 표시될 위치입니다 
										var markerPosition = new daum.maps.LatLng(data2.response.body.items.item[j].mapy, data2.response.body
											.items.item[j].mapx);

										// 마커를 생성합니다
										var marker = new daum.maps.Marker({
											position: markerPosition
										});

										// 마커가 지도 위에 표시되도록 설정합니다
										marker.setMap(map);

										(function (marker, title) {
											daum.maps.event.addListener(marker, 'mouseover', function () {
												displayInfowindow(marker, title);
											});

											daum.maps.event.addListener(marker, 'mouseout', function () {
												infowindow.close();
											});

										})(marker, data2.response.body.items.item[j].title);

										function displayInfowindow(marker, title) {
											var content = '<div style="padding:5px;z-index:1;">' + title + '</div>';

											infowindow.setContent(content);
											infowindow.open(map, marker);
										}


									}
								}
							}
						},
						error: function (e1) {
							swal({
							type: 'error',
							title: '오류',
							text: '값을 불러올 수 없습니다. 다시 확인해 주세요',
							showConfirmButton: false,
							timer: 1500
						})
						}
					});

					/* },
				error : function(error) {
					alert("값을 불러올 수 없습니다. 다시 확인해 주세요");
				}
			});  */

				},
				error: function (e2) {
					swal({
							type: 'error',
							title: '오류',
							text: '값을 불러올 수 없습니다. 다시 확인해 주세요',
							showConfirmButton: false,
							timer: 1500
						})
				}
			});
		});

		var currentPage = 1;

		function TPupdat() {
			let idx = 0;

			for (let item of $(".r-cm")) {
				var param = {
					plday: planday,
					tno: contentId[idx],
					descr: item.value
				};
				console.log(idx);
				console.log("plday:", planday, ", data:", $(".r-cm")[idx].value, ", no:", contentId[idx]);
				console.log(param);
				$.ajax({
					type: "POST",
					url: serverRoot + "/json/travelPlan/update",
					data: param,
					success: function (up) {
						location.href = "travelmate_list.html?" + link;
					},
					error: function (up) {
						swal({
							type: 'error',
							title: '오류',
							text: '값을 저장할 수 없습니다. 다시시도해주세요',
							showConfirmButton: false,
							timer: 1500
						})
					}

				});
				idx++;
			}
		}
	</script>
	
 
<style type="text/css">
.mainTitle{display: inline-block;width:80%;}

.gender{display: inline-block;height:28px;}
.gender select{height:28px;}
.p-num{display: inline-block;height:28px;}
.p-num select{height:28px;}
</style>


</body>

</html>